# üìà gcsBot - Bot de Trading para BTC/USDT com Machine Learning

![Python](https://img.shields.io/badge/Python-3.12-blue.svg) ![License](https://img.shields.io/badge/License-MIT-green.svg) ![Docker](https://img.shields.io/badge/Docker-Ready-blue?logo=docker)

Um bot de trading algor√≠tmico de n√≠vel profissional para o par BTC/USDT na Binance, que utiliza t√©cnicas avan√ßadas de Machine Learning e gest√£o de portf√≥lio din√¢mica para otimizar estrat√©gias e operar de forma aut√¥noma.

---

## üìã Tabela de Conte√∫dos

- [Sobre o Projeto](#-sobre-o-projeto)
- [‚ú® Core Features](#-core-features)
- [üß† Como o Bot "Pensa"? (A Estrat√©gia)](#-como-o-bot-pensa-a-estrat√©gia)
- [‚öôÔ∏è O Ecossistema do Bot: Como os M√≥dulos Interagem](#Ô∏è-o-ecossistema-do-bot-como-os-m√≥dulos-interagem)
- [üöÄ Come√ßando](#-come√ßando)
  - [Pr√©-requisitos](#pr√©-requisitos)
  - [Instala√ß√£o](#instala√ß√£o)
- [üîß Configura√ß√£o do Ambiente (`.env`)](#-configura√ß√£o-do-ambiente-env)
- [‚ñ∂Ô∏è Como Usar (Workflow Profissional)](#Ô∏è-como-usar-workflow-profissional)
  - [Fase 1: Otimiza√ß√£o (`optimize`)](#fase-1-otimiza√ß√£o-optimize)
  - [Fase 2: Backtest R√°pido (`backtest`)](#fase-2-backtest-r√°pido-backtest)
  - [Fase 3: Valida√ß√£o em Testnet (`test`)](#fase-3-valida√ß√£o-em-testnet-test)
  - [Fase 4: Produ√ß√£o (`trade`)](#fase-4-produ√ß√£o-trade)
  - [Comandos Adicionais](#comandos-adicionais)
- [üìÇ Estrutura do Projeto](#-estrutura-do-projeto)
- [üìú Licen√ßa](#-licen√ßa)

---

## ü§ñ Sobre o Projeto

Este n√£o √© um bot de trading comum. Ele foi projetado para tomar decis√µes baseadas em dados e estat√≠sticas, n√£o em regras fixas. O sistema utiliza um pipeline completo de Machine Learning e um gerenciador de portf√≥lio para:

1.  **Aprender** com um vasto hist√≥rico de dados de mercado para prever oportunidades.
2.  **Gerenciar o Risco** de forma din√¢mica, ajustando o tamanho de cada opera√ß√£o com base no capital dispon√≠vel.
3.  **Otimizar** seus pr√≥prios par√¢metros atrav√©s de um processo robusto de Walk-Forward Optimization (WFO).
4.  **Validar** a estrat√©gia otimizada em dados futuros "n√£o vistos" para garantir a robustez.
5.  **Operar** de forma aut√¥noma nos ambientes de Teste (Testnet) ou Produ√ß√£o (Conta Real) da Binance.

O objetivo √© encontrar e explorar inefici√™ncias no mercado, combinando an√°lise t√©cnica e macroecon√¥mica, sempre sob uma camada de gest√£o de capital disciplinada.

---

## ‚ú® Core Features

- **üß† Modelo Preditivo (LightGBM):** Utiliza um modelo de Gradient Boosting r√°pido e eficiente para encontrar padr√µes nos dados.
- **üíº Gest√£o de Portf√≥lio Din√¢mica:** Gerencia o capital de forma inteligente, separando fundos para holding e para trading, com c√°lculo de risco percentual din√¢mico por opera√ß√£o.
- **üîç Otimiza√ß√£o de Hiperpar√¢metros (Optuna):** Encontra a melhor combina√ß√£o de par√¢metros para o modelo e para a estrat√©gia em cada janela de tempo.
- **üõ°Ô∏è Walk-Forward Optimization (WFO):** A metodologia de backtesting mais robusta, que simula o desempenho do bot em condi√ß√µes de mercado din√¢micas, for√ßando-o a se adaptar continuamente.
- **œÅŒµŒ±ŒªŒπœÉŒºœåœÇ Backtest Realista:** A simula√ß√£o de backtest inclui **custos operacionais** (taxas e slippage) e √© livre de **look-ahead bias**, garantindo que os resultados da otimiza√ß√£o sejam honestos.
- **üíµ Integra√ß√£o de Dados Macroecon√¥micos:** Incorpora a varia√ß√£o hor√°ria de m√∫ltiplos indicadores (DXY, VIX, Ouro, T√≠tulos de 10 anos) como features para um rico contexto de mercado.
- **üöÄ Cache Inteligente de Dados:** Salva os dados pr√©-processados e unificados, permitindo uma inicializa√ß√£o quase instant√¢nea nas execu√ß√µes seguintes e viabilizando o modo offline.
- **üîå Modo Offline Robusto:** Permite rodar a otimiza√ß√£o inteira sem conex√£o com a internet (usando dados locais e de cache) e possui travas de seguran√ßa que impedem o in√≠cio dos modos de trade real/teste se a internet n√£o estiver dispon√≠vel.
- **üê≥ Deployment com Docker:** Empacotado em um container Docker para um deployment f√°cil, port√°til e consistente entre diferentes m√°quinas.
- **‚ñ∂Ô∏è Orquestrador Inteligente (`run.py`):** Um ponto de entrada √∫nico que gerencia todo o ciclo de vida do bot, desde a instala√ß√£o at√© a execu√ß√£o dos diferentes modos.
- **üìù Logging Detalhado:** Sistema de logs inteligente que registra n√£o apenas os trades, mas o estado completo do portf√≥lio e o progresso da otimiza√ß√£o.

---

## üß† Como o Bot "Pensa"? (A Estrat√©gia)

O bot √© um especialista em encontrar **padr√µes num√©ricos** nos dados de mercado. Ele analisa uma combina√ß√£o de "impress√µes digitais" (features) de volatilidade, tend√™ncia, momento e macroeconomia para tomar uma decis√£o. Quando o modelo encontra um padr√£o com alta probabilidade estat√≠stica de sucesso, ele passa a decis√£o para o **Gerenciador de Portf√≥lio**, que calcula o tamanho exato da posi√ß√£o com base nas regras de risco definidas, garantindo que nenhuma opera√ß√£o individual possa comprometer o capital total.

---

## ‚öôÔ∏è O Ecossistema do Bot: Como os M√≥dulos Interagem

O bot opera em diferentes modos, utilizando combina√ß√µes espec√≠ficas de arquivos.

#### Modo de Otimiza√ß√£o (`optimize`)

Neste modo, o bot est√° em seu "laborat√≥rio de pesquisa".

- **`optimizer.py`**: √â o c√©rebro da opera√ß√£o. Ele gerencia o processo de Walk-Forward.
- **`model_trainer.py`**: √â chamado pelo otimizador para treinar um novo modelo a cada ciclo.
- **`backtest.py`**: Para cada modelo treinado, executa uma simula√ß√£o realista. O resultado (Sharpe Ratio) √© devolvido ao otimizador.
- **Resultado Final:** A cria√ß√£o dos arquivos `trading_model.pkl`, `scaler.pkl` e `strategy_params.json` na pasta `/data`.

#### Modo de Backtest R√°pido (`backtest`)

Um modo de valida√ß√£o para testar o modelo mais recente em um per√≠odo futuro.

- **`quick_tester.py`**: O m√≥dulo principal deste modo. Ele carrega os arquivos gerados pela otimiza√ß√£o.
- **Simula√ß√£o Realista:** Executa uma simula√ß√£o vela a vela no per√≠odo de teste definido, usando a mesma l√≥gica de gest√£o de portf√≥lio do modo de trade real.
- **Resultado Final:** Um relat√≥rio detalhado de performance m√™s a m√™s impresso no terminal.

#### Modos de Opera√ß√£o (`test` e `trade`)

Neste modo, o bot est√° "em campo", operando no mercado ao vivo.

- **`trading_bot.py`**: √â o √∫nico m√≥dulo ativo. Ele √© o piloto.
- **`PortfolioManager`**: Uma classe dentro do `trading_bot.py` que gerencia ativamente o capital, calcula o tamanho das posi√ß√µes e protege a carteira.
- **Conex√£o com a Binance**: Usa as chaves de API para enviar ordens para a Testnet (modo `test`) ou para a conta real (modo `trade`).

---

## üöÄ Come√ßando

Siga estes passos para colocar o bot em funcionamento.

### Pr√©-requisitos

- [Python 3.10+](https://www.python.org/downloads/)
- [Git](https://git-scm.com/downloads)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)

### Instala√ß√£o

1.  **Clone o reposit√≥rio:**
    ```bash
    git clone [https://github.com/giakomogcs/gcsbot-btc.git](https://github.com/giakomogcs/gcsbot-btc.git)
    cd gcsbot-btc
    ```
2.  **Execute o Setup Autom√°tico:**
    ```bash
    python run.py setup
    ```
    ‚ö†Ô∏è **Aten√ß√£o:** Este comando criar√° um arquivo `.env`. **Voc√™ deve abri-lo e preencher todas as vari√°veis necess√°rias.**
3.  **Construa a Imagem Docker:**
    ```bash
    python run.py build
    ```

---

## üîß Configura√ß√£o do Ambiente (`.env`)

O arquivo `.env` √© o painel de controle principal do bot.

- **`MODE`**: Define o modo de opera√ß√£o. Use `optimize`, `backtest`, `test`, ou `trade`.
- **`SYMBOL`**: O par de moedas a ser operado (ex: `BTCUSDT`).
- **`FORCE_OFFLINE_MODE`**: `True` ou `False`. Se `True`, o bot n√£o tentar√° nenhuma conex√£o com a internet e usar√° apenas dados locais/em cache. Impede a execu√ß√£o dos modos `test` e `trade`.

#### Chaves de API

- `BINANCE_API_KEY` & `BINANCE_API_SECRET`: Suas chaves da conta **real**.
- `BINANCE_TESTNET_API_KEY` & `BINANCE_TESTNET_API_SECRET`: Suas chaves da conta **Testnet**.

#### Gest√£o de Portf√≥lio

- `MAX_USDT_ALLOCATION`: O **M√ÅXIMO** de capital em USDT que o bot tem permiss√£o para gerenciar.
- `LONG_TERM_HOLD_PCT`: Percentual do capital que ser√° usado para comprar e manter BTC como holding. Ex: `0.50` para 50%.
- `RISK_PER_TRADE_PCT`: Do capital de **trading** restante, qual a porcentagem de risco por opera√ß√£o? Ex: `0.02` para arriscar 2%.

#### Backtest R√°pido

- `BACKTEST_START_DATE` & `BACKTEST_END_DATE`: Define o per√≠odo para a simula√ß√£o do modo `backtest`. Ex: `2025-01-01`.

> ‚ö†Ô∏è **Nunca compartilhe ou envie seu arquivo `.env` para reposit√≥rios p√∫blicos!**

---

## ‚ñ∂Ô∏è Como Usar (Workflow Profissional)

A intera√ß√£o com o bot √© feita atrav√©s do orquestrador `run.py`. Siga estas fases na ordem correta.

### Fase 1: Otimiza√ß√£o

O passo mais importante. O bot ir√° estudar todo o hist√≥rico para encontrar a melhor estrat√©gia e criar os arquivos de modelo.

```bash
python run.py optimize
```

Este processo √© longo e pode levar horas ou dias. Ao final, os arquivos `trading_model.pkl`, `scaler.pkl` e `strategy_params.json` ser√£o salvos na pasta /data.

---

### Fase 2: Backtest R√°pido

Ap√≥s a otimiza√ß√£o, valide a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py backtest
```

O bot ir√° rodar a simula√ß√£o no per√≠odo definido no .env e imprimir um relat√≥rio de performance m√™s a m√™s no terminal.

---

### Fase 3: Valida√ß√£o em Testnet

Ap√≥s a otimiza√ß√£o, valide a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py test
```

O bot iniciar√° em segundo plano e rodar√° 24/7. Ele usar√° o modelo e os par√¢metros criados na Fase 1. Deixe rodando por pelo menos 1-2 semanas para obter dados estat√≠sticos relevantes.

---

### Fase 3: Trading Real

Ap√≥s a otimiza√ß√£o, valide a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py trade
```

O bot operar√° da mesma forma que no modo test, mas utilizando sua conta real da Binance.

---

## Comandos Adicionais

- Ver os Logs em Tempo Real:

```bash
python run.py logs
```

- Parar o Bot (Modo `test` ou `trade`):

```bash
python run.py stop
```

---

# üìÇ Estrutura do Projeto

```bash
gcsbot-btc/
‚îú‚îÄ‚îÄ data/                  # Dados gerados (CSVs, modelos, estados) - Ignorado pelo Git
‚îú‚îÄ‚îÄ logs/                  # Arquivos de log di√°rios - Ignorado pelo Git
‚îú‚îÄ‚îÄ src/                   # C√≥digo fonte do projeto
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ backtest.py        # M√≥dulo de backtesting para a otimiza√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # Carrega e gerencia as configura√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ data_manager.py    # Gerencia a coleta, unifica√ß√£o e cache de dados
‚îÇ   ‚îú‚îÄ‚îÄ logger.py          # Configura√ß√£o do sistema de logs
‚îÇ   ‚îú‚îÄ‚îÄ model_trainer.py   # Prepara features e treina o modelo de ML
‚îÇ   ‚îú‚îÄ‚îÄ optimizer.py       # Orquestra o Walk-Forward Optimization
‚îÇ   ‚îú‚îÄ‚îÄ quick_tester.py    # L√≥gica para o modo de backtest r√°pido
‚îÇ   ‚îî‚îÄ‚îÄ trading_bot.py     # L√≥gica de opera√ß√£o e gest√£o de portf√≥lio
‚îú‚îÄ‚îÄ .dockerignore          # Arquivos a serem ignorados pelo Docker
‚îú‚îÄ‚îÄ .env.example           # Exemplo do arquivo de configura√ß√£o
‚îú‚îÄ‚îÄ .gitignore             # Arquivos a serem ignorados pelo Git
‚îú‚îÄ‚îÄ Dockerfile             # Define o ambiente Docker para o bot
‚îú‚îÄ‚îÄ main.py                # Ponto de entrada (usado pelo Docker)
‚îú‚îÄ‚îÄ README.md              # Esta documenta√ß√£o
‚îú‚îÄ‚îÄ requirements.txt       # Depend√™ncias Python
‚îî‚îÄ‚îÄ run.py                 # Orquestrador principal e ponto de entrada do usu√°rio
```
