# üìà gcsBot - Framework de Trading Quantitativo para BTC/USDT

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg) ![Docker](https://img.shields.io/badge/Docker-Ready-blue?logo=docker) ![License](https://img.shields.io/badge/License-MIT-green.svg)

Um framework de ponta para pesquisa, valida√ß√£o e execu√ß√£o de estrat√©gias de trading algor√≠tmico no par BTC/USDT. Este projeto vai al√©m de um simples bot, oferecendo um pipeline completo de Machine Learning, desde a otimiza√ß√£o de estrat√©gias com dados hist√≥ricos at√© a opera√ß√£o aut√¥noma e adaptativa na Binance.

---

## üìã Tabela de Conte√∫dos

- [üåü Sobre o Projeto](#-sobre-o-projeto)
- [‚ú® Features de Destaque](#-features-de-destaque)
- [üß† A Filosofia do Bot: Como Ele Pensa?](#-a-filosofia-do-bot-como-ele-pensa)
- [‚öôÔ∏è Ecossistema do Bot: Como os M√≥dulos Interagem](#Ô∏è-ecossistema-do-bot-como-os-m√≥dulos-interagem)
- [üöÄ Guia de In√≠cio R√°pido](#-guia-de-in√≠cio-r√°pido)
- [üîß Configura√ß√£o do Ambiente (`.env`)](#-configura√ß√£o-do-ambiente-env)
- [‚ñ∂Ô∏è O Workflow Profissional: Como Usar](#Ô∏è-o-workflow-profissional-como-usar)
- [üìÇ Estrutura do Projeto](#-estrutura-do-projeto)
- [üìú Licen√ßa](#-licen√ßa)

---

## üåü Sobre o Projeto

Este reposit√≥rio cont√©m um sistema de trading algor√≠tmico completo, projetado para ser robusto, inteligente e metodologicamente correto. Diferente de bots baseados em regras fixas, o gcsBot utiliza um modelo de **Machine Learning (LightGBM)** para encontrar padr√µes preditivos e uma arquitetura sofisticada para se adaptar √†s din√¢micas do mercado.

O n√∫cleo do projeto √© um processo de **Walk-Forward Optimization (WFO)** que garante que a estrat√©gia seja constantemente reavaliada e otimizada em dados novos, evitando o overfitting e a estagna√ß√£o. O resultado √© um agente aut√¥nomo que n√£o apenas opera, mas aprende e se ajusta.

---

## ‚ú® Features de Destaque

- **üß† Intelig√™ncia Multi-Camada:**

  - **Gest√£o Ativa de Posi√ß√£o:** Uma vez em um trade, o bot gerencia ativamente o risco com t√©cnicas de **Breakeven Stop, Realiza√ß√£o de Lucro Parcial e Trailing Stop**.
  - **Estrat√©gia de Duplo Objetivo:** O bot n√£o s√≥ busca lucro em USDT, mas tamb√©m o utiliza para **acumular um "Tesouro de BTC"** a longo prazo, alocando uma porcentagem dos lucros para essa finalidade.
  - **Confian√ßa Din√¢mica:** O bot ajusta sua pr√≥pria "coragem" com base na performance de uma **janela de trades recentes**, tornando-se mais ousado em sequ√™ncias de vit√≥rias e mais cauteloso ap√≥s perdas.
  - **Risco Din√¢mico (Bet Sizing):** O tamanho de cada opera√ß√£o √© proporcional √† convic√ß√£o do modelo e ao regime de mercado atual, arriscando de forma inteligente.

- **ü§ñ Metodologia de N√≠vel Profissional:**

  - **Otimiza√ß√£o Robusta (Calmar Ratio):** O sistema utiliza `Optuna` para otimizar a estrat√©gia buscando o melhor **Calmar Ratio** (Retorno Anualizado / M√°ximo Drawdown), priorizando a seguran√ßa do capital.
  - **Filtro de Regime de Mercado:** O bot primeiro identifica o estado do mercado (ex: `BULL_FORTE`, `BEAR`, `LATERAL`) e ajusta seu comportamento de risco ou at√© mesmo bloqueia opera√ß√µes.
  - **Valida√ß√£o Robusta (Train/Validate/Test):** O processo de otimiza√ß√£o utiliza uma metodologia rigorosa que impede o vazamento de dados do futuro (_look-ahead bias_).

- **‚öôÔ∏è Engenharia de Ponta:**
  - **Backtest Realista:** Todas as simula√ß√µes incluem custos operacionais (taxas e slippage) para uma avalia√ß√£o de performance fiel √† realidade.
  - **Atualiza√ß√£o Autom√°tica de Dados:** Coleta e atualiza automaticamente n√£o s√≥ os dados de cripto da Binance, mas tamb√©m os **dados macroecon√¥micos** (DXY, Ouro, VIX, TNX) via `yfinance`.
  - **Deployment com Docker:** Ambiente 100% conteinerizado para uma execu√ß√£o consistente e livre de problemas de depend√™ncias.
  - **Logs e Visualiza√ß√£o Avan√ßados:** Utiliza `tqdm` e `tabulate` para oferecer barras de progresso e relat√≥rios claros e f√°ceis de ler.

---

## üß† A Filosofia do Bot: Como Ele Pensa?

A tomada de decis√£o do gcsBot segue uma **hierarquia de intelig√™ncia em 3 camadas**, imitando uma estrutura de comando militar para garantir decis√µes robustas e bem fundamentadas:

### **Camada 1: O General (Estrat√©gia)**

- **Pergunta:** "O campo de batalha √© favor√°vel? Devemos lutar hoje?"
- **A√ß√£o:** Analisa o **regime de mercado** de longo prazo (`BULL_FORTE`, `BEAR`, etc.) usando m√©dias m√≥veis di√°rias. Com base nesse cen√°rio, ele define a pol√≠tica de risco geral: se os trades s√£o permitidos e qual o n√≠vel de agressividade. Em um regime `BEAR`, o General pode ordenar a retirada total, preservando o capital.

### **Camada 2: O Capit√£o (T√°tica)**

- **Pergunta:** "Dado que o General deu sinal verde, este √© o momento exato para atacar?"
- **A√ß√£o:** O **modelo de Machine Learning**, treinado com dados recentes e ciente do regime de mercado, busca por padr√µes de curto prazo que indiquem uma oportunidade de compra com alta probabilidade. Ele gera um sinal de "confian√ßa de compra".

### **Camada 3: O Soldado (Execu√ß√£o e Gest√£o)**

- **Pergunta:** "Ataque iniciado. Como gerenciamos esta posi√ß√£o para maximizar ganhos e minimizar perdas?"
- **A√ß√£o:** Uma vez que a compra √© executada, este m√≥dulo assume o controle com regras precisas:
  1.  **Prote√ß√£o:** Move o stop para o _breakeven_ assim que o trade atinge um pequeno lucro, eliminando o risco sobre o capital principal.
  2.  **Realiza√ß√£o:** Garante parte do lucro vendendo uma fra√ß√£o da posi√ß√£o ao atingir o alvo de lucro.
  3.  **Maximiza√ß√£o:** Deixa o restante da posi√ß√£o "correr" com um _trailing stop_ para capturar tend√™ncias maiores.
  4.  **Tesouraria:** Aloca uma parte do lucro realizado para o "Tesouro de BTC", cumprindo o objetivo de acumula√ß√£o de longo prazo.

Este processo transforma o bot de um simples executor de sinais em um agente estrat√©gico que pensa em m√∫ltiplas camadas.

---

## ‚öôÔ∏è Ecossistema do Bot: Como os M√≥dulos Interagem

- **`optimizer.py`**: O c√©rebro da pesquisa. Gerencia o WFO, chama o `model_trainer` e o `backtest`, e usa o `Optuna` para encontrar os melhores par√¢metros para a estrat√©gia completa, otimizando pelo Calmar Ratio.
- **`model_trainer.py`**: O "cientista de dados". Prepara todas as features (t√©cnicas, macro e de regime) e treina o modelo LightGBM para que ele entenda o contexto do mercado.
- **`confidence_manager.py`**: O "psic√≥logo" do bot. Implementa a l√≥gica para ajustar a confian√ßa com base na performance recente, tornando-o mais est√°vel.
- **`backtest.py`**: O simulador de combate. Executa a estrat√©gia Multi-Camada completa de forma realista para fornecer as m√©tricas de performance (Drawdown, Retorno) para o otimizador.
- **`quick_tester.py`**: O "auditor". Permite validar um modelo j√° treinado em um per√≠odo de tempo futuro, gerando um relat√≥rio completo com as novas m√©tricas de performance.
- **`trading_bot.py`**: O "piloto de elite". M√≥dulo que opera no mercado real, implementando a mesma estrat√©gia Multi-Camada validada na otimiza√ß√£o.

---

## üöÄ Guia de In√≠cio R√°pido

Siga estes passos para colocar o bot em funcionamento.

### Pr√©-requisitos

- [Python 3.11+](https://www.python.org/downloads/)
- [Git](https://git-scm.com/downloads)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) (em execu√ß√£o)

### Instala√ß√£o

1.  **Clone o reposit√≥rio:**
    ```bash
    git clone https://github.com/SEU_USUARIO/gcsbot-btc.git
    cd gcsbot-btc
    ```
2.  **Execute o Setup Autom√°tico:**
    Este comando ir√° verificar o ambiente, instalar as depend√™ncias e criar o seu arquivo de configura√ß√£o `.env`.

    ```bash
    python run.py setup
    ```

    > ‚ö†Ô∏è **Aten√ß√£o:** Ap√≥s o setup, abra o arquivo `.env` rec√©m-criado e preencha **todas** as vari√°veis, especialmente suas chaves de API.

3.  **Construa a Imagem Docker:**
    ```bash
    python run.py build
    ```

---

## üîß Configura√ß√£o do Ambiente (`.env`)

O arquivo `.env` √© o painel de controle principal do bot.

- **`MODE`**: Modo de opera√ß√£o: `optimize`, `backtest`, `test`, ou `trade`.
- **`FORCE_OFFLINE_MODE`**: `True` ou `False`. Impede o bot de acessar a internet (√∫til para otimiza√ß√µes).

#### Chaves de API

- `BINANCE_API_KEY` & `BINANCE_API_SECRET`: Chaves da conta **real**.
- `BINANCE_TESTNET_API_KEY` & `BINANCE_TESTNET_API_SECRET`: Chaves da conta **Testnet**.

#### Gest√£o de Portf√≥lio (Para os modos `test` e `trade`)

- `MAX_USDT_ALLOCATION`: O **M√ÅXIMO** de capital em USDT que o bot tem permiss√£o para gerenciar na sua parte de trading.

---

## ‚ñ∂Ô∏è O Workflow Profissional: Como Usar

A intera√ß√£o com o bot √© feita atrav√©s do orquestrador `run.py`. Siga estas fases na ordem correta.

### Passo Zero: Limpeza do Ambiente (MUITO IMPORTANTE)

Antes de iniciar uma **nova** otimiza√ß√£o para uma estrat√©gia reformulada, √© essencial apagar os artefatos antigos para garantir que o sistema comece do zero, sem nenhuma informa√ß√£o da estrat√©gia anterior.

**Apague os seguintes arquivos do seu diret√≥rio `/data`:**

- `model.joblib`
- `scaler.joblib`
- `strategy_params.json`
- `wfo_optimization_state.json`
- `combined_data_cache.csv`

### Fase 1: Pesquisa e Otimiza√ß√£o (`optimize`)

O passo mais importante. O bot ir√° estudar todo o hist√≥rico para encontrar a melhor estrat√©gia e criar os arquivos de modelo.

```bash
python run.py optimize
```

Este processo √© longo e pode levar horas ou dias. Ao final, os arquivos `trading_model.pkl`, `scaler.pkl` e `strategy_params.json` ser√£o salvos na pasta /data.

---

### Fase 2: Backtest R√°pido

Ap√≥s a otimiza√ß√£o, valide a nova estrat√©gia em um per√≠odo que o modelo nunca viu durante o treino.

```bash
python run.py backtest --start "2024-01-01" --end "2025-01-01"
```

O bot ir√° rodar a simula√ß√£o e imprimir um relat√≥rio de performance completo, incluindo Calmar Ratio e o Tesouro de BTC acumulado.

---

### Fase 3: Valida√ß√£o em Testnet

Se a valida√ß√£o for positiva, teste a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py test
```

Ele usar√° o modelo e os par√¢metros criados na Fase 1. Deixe rodando por pelo menos 1-2 semanas para observar o comportamento em tempo real.

---

### Fase 3: Trading Real

O passo final. O bot operar√° da mesma forma que no modo test, mas utilizando sua conta real da Binance e sua aloca√ß√£o de capital definida.

```bash
python run.py trade
```

---

## Comandos Adicionais

- Ver os Logs em Tempo Real:

```bash
python run.py logs
```

- Parar o Bot (Modo `test` ou `trade`):

```bash
python run.py stop
```

---

# üìÇ Estrutura do Projeto

```bash
gcsbot-btc/
‚îú‚îÄ‚îÄ data/                  # Dados gerados (CSVs, modelos, estados) - Ignorado pelo Git
‚îú‚îÄ‚îÄ logs/                  # Arquivos de log di√°rios - Ignorado pelo Git
‚îú‚îÄ‚îÄ src/                   # C√≥digo fonte do projeto
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ backtest.py        # Motor de simula√ß√£o realista (usado pela otimiza√ß√£o)
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # Gerenciador de configura√ß√µes do .env
‚îÇ   ‚îú‚îÄ‚îÄ confidence_manager.py # C√©rebro da confian√ßa adaptativa
‚îÇ   ‚îú‚îÄ‚îÄ data_manager.py    # Gerenciador de coleta e cache de dados
‚îÇ   ‚îú‚îÄ‚îÄ logger.py          # Configura√ß√£o do sistema de logs
‚îÇ   ‚îú‚îÄ‚îÄ model_trainer.py   # Prepara features e treina o modelo de ML
‚îÇ   ‚îú‚îÄ‚îÄ optimizer.py       # Orquestrador do Walk-Forward Optimization (WFO)
‚îÇ   ‚îú‚îÄ‚îÄ quick_tester.py    # L√≥gica para o modo de backtest r√°pido (valida√ß√£o)
‚îÇ   ‚îî‚îÄ‚îÄ trading_bot.py     # L√≥gica de opera√ß√£o real e gest√£o de portf√≥lio
‚îú‚îÄ‚îÄ .dockerignore          # Arquivos a serem ignorados pelo Docker
‚îú‚îÄ‚îÄ .env.example           # Exemplo do arquivo de configura√ß√£o
‚îú‚îÄ‚îÄ .gitignore             # Arquivos a serem ignorados pelo Git
‚îú‚îÄ‚îÄ Dockerfile             # Define o ambiente Docker para o bot
‚îú‚îÄ‚îÄ main.py                # Ponto de entrada principal (usado pelo Docker)
‚îú‚îÄ‚îÄ README.md              # Esta documenta√ß√£o
‚îú‚îÄ‚îÄ requirements.txt       # Depend√™ncias Python
‚îî‚îÄ‚îÄ run.py                 # Orquestrador principal e ponto de entrada do usu√°rio
```
